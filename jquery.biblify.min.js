(function(e){e.fn.biblify=function(e){function n(n){var r=t.exec(n);if(r!==null){return n.replace(t,function(t,n,r,i,s,o,u,a,f,l,c){var h=n===undefined?"":n;var p=r;var d=o;var v=a;var m=l;var g="";if(p!==undefined&&d!==undefined&&v!==undefined){var y,b,w="";y=p+e.url.chapter+d;w=p+e.display.chapter+d;b=p+e.tooltip.chapter+d;if(v&&m){y+=e.url.verse+v+e.url.range+m;w+=e.display.verseplural+v+e.display.range+m;b+=e.tooltip.verseplural+v+e.tooltip.range+m}else if(v){y+=e.url.verse+v;w+=e.display.verse+v;b+=e.tooltip.verse+v;g=f}y=encodeURI(y);var E=e.content.replace("{url}",y).replace("{tooltip}",b).replace("{display}",w)+g;return h+E}return t})}return false}function r(e){if(e.remove){e.remove()}else if(e.removeNode){e.removeNode()}}function i(e,t){function o(e){if(e.tagName==="A"||e.tagName==="a"){return}if(e.nodeType===3){if(e.length>0&&s.test(e.nodeValue)){var t=n(e.nodeValue);if(t!==undefined&&t){return{node:e,markup:t}}}}else{var i=[];for(var u=0,a=e.childNodes.length;u<a;++u){var f=o(e.childNodes[u]);if(f){if(e.childNodes.length===1){f.type="all";f.editNode=e;i.push(f)}else if(u>0){f.type="after";f.editNode=e.childNodes[u-1];i.push(f)}else if(u<e.childNodes.length-1){f.type="before";f.editNode=e.childNodes[u+1];i.push(f)}}}if(i.length>0){for(var l=0;l<i.length;l++){switch(i[l].type){case"all":i[l].editNode.insertAdjacentHTML("afterbegin",i[l].markup);r(i[l].node);break;case"after":i[l].editNode.insertAdjacentHTML("afterend",i[l].markup);r(i[l].node);break;case"before":i[l].editNode.insertAdjacentHTML("beforebegin",i[l].markup);r(i[l].node);break}}}}}var i=[],s=/\S/;o(e)}e=e||{};e.content=e.content||'<a class="bible" href="http://www.biblegateway.com/passage/?version=AKJV&search={url}" title="Read {tooltip} on BibleGateway.com" target="_blank">{display}</a>';e.url=e.url||{};e.url.href=e.url.href||"";e.url.chapter=e.url.chapter||"";e.url.verse=e.url.verse||":";e.url.range=e.url.range||"-";e.display=e.display||{};e.display.chapter=e.display.chapter||" ";e.display.verse=e.display.verse||"v";e.display.verseplural=e.display.verseplural||"v";e.display.range=e.display.range||"-";e.tooltip=e.tooltip||{};e.tooltip.chapter=e.tooltip.chapter||" chapter ";e.tooltip.verse=e.tooltip.verse||" verse ";e.tooltip.verseplural=e.tooltip.verseplural||" verses ";e.tooltip.range=e.tooltip.range||" to ";var t=/(<=^|[ ]*)((1[ ]*[cjkpst]|2[ ]*[cjkpst]|3[ ]*j|a[cm]|co|d[ae]|e[cpsxz]|g[ae]|h[aeo]|is|j[aeou]|l[aekuv]|m[ai]|n[aeu]|ob|p[hrs]|r[eou]|song[ ]*[o]?[f]?[ ]*|ti|z[ae])[a-z]{0,12})([ ]*)([0-9]+)([,v\.\-: ]*)([0-9]+)([,\- ]*)([0-9]*)|([0-9])/ig;return this.each(function(){i(this)})}})(jQuery)
